---
- name: Apply command(s) for grub_ changes
  become: true
  ansible.builtin.command:
    chdir: "{{ item.chdir | default(omit) }}"
    cmd: "{{ item.cmd }}"
    creates: "{{ item.creates | default(omit) }}"
    removes: "{{ item.removes | default(omit) }}"
    stdin: "{{ item.stdin | default(omit) }}"
    stdin_add_newline: "{{ item.stdin_add_newline | default(omit) }}"
    strip_empty_ends: "{{ item.strip_empty_ends | default(omit) }}"
  changed_when: true
  loop: "{{ grub__change | selectattr('cmd', 'defined') }}"
  register: grub__apply_changes_command
  listen: "grub__apply_changes_by_command"
  when:
    - grub__change_strategy | default('') == 'command'
    - grub__change | type_debug == 'list'
    - grub__change | selectattr('cmd', 'defined') | length > 0
