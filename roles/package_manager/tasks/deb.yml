---
- name: Manage DEB repository keys via APT
  become: true
  ansible.builtin.apt_key:
    state: "{{ item.state | default(omit) }}"
    data: "{{ item.data | default(omit) }}"
    file: "{{ item.file | default(omit) }}"
    keyring: "{{ item.keyring | default(omit) }}"
    url: "{{ item.url | default(omit) }}"
    validate_certs: "{{ item.validate_certs | default(omit) | bool }}"
  loop: "{{ package_manager__repo_keys_all }}"
  register: package_manager__deb_repo_keys_apply
  when:
    - package_manager__repo_keys_all | type_debug == 'list'
    - package_manager__repo_keys_all | length > 0

- name: Manage DEB repositories via APT
  become: true
  ansible.builtin.apt_repository:
    repo: "{{ item.repo }}"
    state: "{{ item.state | default(omit) }}"
    codename: "{{ item.codename | default(omit) }}"
    filename: "{{ item.filename | default(omit) }}"
    install_python_apt: "{{ item.install_python_apt | default(omit) | bool }}"
    mode: "{{ item.mode | default(omit) }}"
    update_cache: "{{ item.update_cache | default(omit) | bool }}"
    update_cache_retries: "{{ item.update_cache_retries | default(omit) }}"
    update_cache_retry_max_delay: "{{ item.update_cache_retry_max_delay | default(omit) }}"
    validate_certs: "{{ item.validate_certs | default(omit) | bool }}"
  loop: "{{ package_manager__repos_all }}"
  register: package_manager__deb_repos_apply
  when:
    - package_manager__repos_all | type_debug == 'list'
    - package_manager__repos_all | length > 0